{"name":"Coffeeshop HTML5 tutorial","body":"Each step of this tutorial is separated in different directory under the git repository for this project.\r\n\r\n* [Step 1: Creating a HTML5 page with basic jquery functionalities](#step-1-creating-a-html5-page-with-basic-jquery-functionalities)\r\n* [Step 2: Use Osgibroker to interact with the HTML page](#step-2-use-osgibroker-to-interact-with-the-html-page)\r\n* [Step 3: Create the Jquery Mobile interface](#step-3-create-the-jquery-mobile-interface)\r\n* [Step 4: Setup application on the coffeshop framework](#step-4-setup-application-on-the-coffeshop-framework)\r\n\r\n\r\n\r\n## Step 1: Creating a HTML5 page with basic jquery functionalities\r\n\r\n### Objective:\r\n1. create a simple HTML5 page and enable users to change the background color of the Body element by calling a JavaScript function\r\n\r\nI start by creating a simple HTML page with basic HTML elements of HTML, HEAD and BODY. I created the index.html page inside the large folder. The code for this step is as follow:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n  <head>\r\n    <script type=\"text/javascript\" src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js\"></script>\r\n    <script>\r\n\tfunction changeBGColor(colorname){\r\n\t\tswitch(colorname)\r\n\t\t{\r\n\t\tcase \"black\":\r\n\t\t  $(\"body\").css(\"background-color\",\"black\");\r\n\t\t  break;\r\n\t\tcase \"red\":\r\n\t\t  $(\"body\").css(\"background-color\",\"red\");\r\n\t\t  break;\r\n\t\tcase \"yellow\":\r\n\t\t  $(\"body\").css(\"background-color\",\"yellow\");\r\n\t\t  break;\r\n\t\tdefault:\r\n\t\t  $(\"body\").css(\"background-color\",colorname);\r\n\t\t  break;\r\n\t\t}\r\n\t}\r\n  </script>\r\n  </head>\r\n  <body>\r\n  </body>\r\n</html>\r\n```\r\n\r\nHere as you can see in the code, line 3 loads the jQuery javascript library into the page and below that is a simple function that accepts the colorname parameter and changes the body tag backgroud-color using a switch statement.\r\n\r\nTo interact with the page you can simply use the developer tools of the chrome browser. Open index.html using chrome and open the developer tools by tools -> developer tools (CTRL+SHIFT+J). In the console type the following;\r\n\r\n```javascript\r\nchangeBGColor(\"red\");\r\n```\r\nYou can see that the background color of the page changes based on the input of the changeBGColor.\r\n## Step 2: Use Osgibroker to interact with the HTML page\r\n\r\n### Objectives: \r\n1. Use ogibroker interface to interact with the application\r\n2. Trigger an event on the Tutorial application using the Ogibroker interface\r\n\r\nTo  interact with the application we use the OSGiBroker. OSGiBroker enables developers to easily implment communication between two applications using their REST API. To read more about OSGiBroker on their website [OSGiBroker](http://www.magic.ubc.ca/wiki/pmwiki.php/OSGiBroker/OSGiBrokerOverview).\r\n\r\nThe OSGiBroker has to be installed on the system, you can read more about how to install the OSGiBroker on ( [installation guid](http://www.magic.ubc.ca/wiki/pmwiki.php/OSGiBroker/Installation) ).\r\n\r\nTo implement the communication between our application and another application we need to use the OSGiBroker REST API. There is a complete instruction on how to use this API found [here](http://magic.ubc.ca/wiki/pmwiki.php/OSGiBroker/Osgibroker-rest). \r\n\r\nFirst the application has to be subscribed on the OSGiBroker server on the machine. We can directly go on the link bellow to subscribe to our tutorial application:\r\n\r\n```\r\nhttp://localhost:8800/osgibroker/subscribe?topic=tutorial&clientID=tutorial\r\n```  \r\nThe two parameters topic and clientID defines the application name and client who used the application. These two parameters have to be sent to http://localhost:8800/osgibroker/subscribe to properly register the application. We can automatically subscribe to the application everytime the page loads by asynchronously loading this URL in our tutorial application using an ajax call.\r\n\r\nNext, we need to see how we can trigger an event on the OSGiBRoker. For that we can use the URL below:\r\n\r\n```\r\nhttp://localhost:8800/osgibroker/event?topic=tutorial&clientID=tutorial&_method=POST&eventName=blue\r\n```\r\nIn this url we can trigger an event for the tutorial application on the OSGiBroker by assigning the event's name to the eventName parameter in the URL above. When this URL is requested from the OSGiBroker server the following response is sent to the browser indicating that the event is successfully triggered for the tutorial application.\r\n\r\n```xml\r\n<event timestamp=\"1339967009799\">\r\n<topic>tutorial</topic>\r\n<clientID>tutorial</clientID>\r\n<eventName>blue</eventName>\r\n<_method>POST</_method>\r\n</event>\r\n``` \r\n\r\nOnce this event is triggered, it remains on the server for the tutorial application, until the event is retrieved from the application using the URL below:\r\n\r\n```\r\nhttp://localhost:8800/osgibroker/event?topic=tutorial&clientID=tutorial&timeOut=1\r\n```\r\n\r\nAnd the response is:\r\n\r\n```xml\r\n<events>\r\n<event timestamp=\"1339970751526\">\r\n<topic>tutorial</topic>\r\n<clientID>tutorial</clientID>\r\n<eventName>blue</eventName>\r\n<_method>POST</_method>\r\n</event>\r\n</events>\r\n```\r\nWe can get the triggered event from the OSGiBroker server and handle it on the application.\r\n\r\nNow we have figured out how the OSGiBroker works and how to subscribe the application and triger an even. Next we are going to implement subscribing the Tutorial application on the OSGiBroker and handling events from OSGiBroker on our application.\r\n\r\nFor that we need two separate php files: subscribe.php and event.php. Codes for the two files are provided below:\r\n\r\nsubscribe.php\r\n```php\r\n<?php\r\n\r\n$daurl = 'http://localhost:8800/osgibroker/subscribe?topic=tutorial&clientID=tutorial';\r\n\r\n// Get that website's content\r\n$handle = fopen($daurl, \"r\");\r\n\r\n// If there is something, read and return\r\nif ($handle) {\r\n    while (!feof($handle)) {\r\n        $buffer = fgets($handle, 4096);\r\n        echo $buffer;\r\n    }\r\n    fclose($handle);\r\n}\r\n?>\r\n```\r\n\r\nevent.php\r\n```php\r\n<?php\r\n\r\n$daurl = 'http://localhost:8800/osgibroker/event?topic=tutorial&clientID=tutorial&timeOut=1';\r\n\r\n// Get that website's content\r\n$handle = fopen($daurl, \"r\");\r\n\r\n// If there is something, read and return\r\nif ($handle) {\r\n    while (!feof($handle)) {\r\n        $buffer = fgets($handle, 4096);\r\n        echo $buffer;\r\n    }\r\n    fclose($handle);\r\n}\r\n?>\r\n```\r\nNow we need to modify the index.html\r\n\r\n```html\r\n<!DOCTYPE html>\r\n  <head>\r\n    <script type=\"text/javascript\" src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js\"></script>\r\n    <script>\r\n\t$(document).ready(function(){\r\n\t\t//subscribe the tutorial application to the tutorial topic\r\n\t\t$.ajax({ type: \"GET\", url: \"subscribe.php\", dataType: \"xml\", success: messageParser });\r\n\r\n\t\t//retreive events and parse them.\r\n\t\tsetInterval(function () {\r\n\t\t\t$.ajax({ type: \"GET\", url: \"event.php\", dataType: \"xml\", success: messageParser });\t\t\r\n\t\t\t}, 2000);\r\n\t});\r\n\r\n\t//using this parser we will get the events and add them to the DOM\r\n\tfunction messageParser(xml) {\r\n\t\t$(xml).find(\"event\").each(function () {\r\n\t\t\tvar color = $(this).find(\"eventName\").text();\r\n\t\t\tchangeBGColor(color);\r\n\t\t});\r\n\t}\r\n\t\r\n\tfunction changeBGColor(colorname){\r\n\t\tswitch(colorname)\r\n\t\t{\r\n\t\tcase \"black\":\r\n\t\t  $(\"body\").css(\"background-color\",\"black\");\r\n\t\t  break;\r\n\t\tcase \"red\":\r\n\t\t  $(\"body\").css(\"background-color\",\"red\");\r\n\t\t  break;\r\n\t\tcase \"yellow\":\r\n\t\t  $(\"body\").css(\"background-color\",\"yellow\");\r\n\t\t  break;\r\n\t\tdefault:\r\n\t\t  $(\"body\").css(\"background-color\",colorname);\r\n\t\t  break;\r\n\t\t}\r\n\t}\r\n  </script>\r\n  </head>\r\n  <body>\r\n  </body>\r\n</html>\r\n```\r\nLine 7 uses the ajax function of the jquery library to send an asynchronous request to subscribe.php. In line 10, we set an interval to send a request to OSGiBroker looking for any available event. If there is any event in the response of this request, then it can get handled using the messageParse.\r\n\r\nWe can try this code by using the URL below:\r\n\r\n```\r\nhttp://localhost:8800/osgibroker/event?topic=tutorial&clientID=tutorial&_method=POST&eventName=blue\r\n```\r\nyou can change the eventName parameter to any other color and you can see how the application handles these different events.\r\n\r\n## Step 3: Create the Jquery Mobile interface\r\n\r\nFor this tutorial, we use [jQuery mobile](http://jquerymobile.com) to build an interface to interact with our application. For that, first we need to create an application interface using the jquerymobile library. Luckily jQuery mobile has an interactive WYSIWG editor to create such an interface available on their website. \r\n\r\n![jQuery mobile editor](https://github.com/hmrtk/Coffeshop-HTML5-jQuery-Mobile-Tutorial/blob/master/images/2.PNG?raw=true)\r\n\r\nI used this editor and generated an interface for our application:\r\n\r\n![Tutorial app jquery mobile interface](https://github.com/hmrtk/Coffeshop-HTML5-jQuery-Mobile-Tutorial/blob/master/images/1.PNG?raw=true)\r\n\r\nmobile/index.html\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n        <title>\r\n        </title>\r\n        <link rel=\"stylesheet\" href=\"http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css\" />\r\n        <link rel=\"stylesheet\" href=\"my.css\" />\r\n        <style>\r\n            /* App custom styles */\r\n        </style>\r\n        <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\">\r\n        </script>\r\n        <script src=\"http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js\">\r\n        </script>\r\n    </head>\r\n    <body>\r\n        <div data-role=\"page\" id=\"page1\">\r\n            <div data-theme=\"b\" data-role=\"header\" data-position=\"fixed\">\r\n                <h3>\r\n                    Tutorial Sample App\r\n                </h3>\r\n            </div>\r\n            <div data-role=\"content\" style=\"padding: 15px\">\r\n                <a id=\"test1\" class=\"appbutton\" data-role=\"button\" data-ajax=\"false\" data-transition=\"fade\" data-theme=\"e\" value=\"Yellow\">\r\n                    Yellow\r\n                </a>\r\n                <a class=\"appbutton\" data-role=\"button\" data-transition=\"fade\" data-theme=\"b\" value=\"Blue\">\r\n                    Blue\r\n                </a>\r\n                <a class=\"appbutton\" data-role=\"button\" data-transition=\"fade\" data-theme=\"a\" value=\"Black\">\r\n                    Black\r\n                </a>\r\n\t\t<div id=\"resultLog\"></div>\r\n            </div>\r\n        </div>\r\n        <script>\r\n        $(function() {\r\n \r\n            $(\".appbutton\").click(function() {\r\n\r\n\t\t     $.ajax({\r\n\t\t      type: \"GET\",\r\n\t\t      url: \"event.php\",\r\n\t\t      data: ({event: $(this).attr('value')}),\r\n\t\t      cache: false,\r\n\t\t      dataType: \"XML\",\r\n\t\t      success: onSuccess\r\n\t\t    });\r\n\r\n            }); \r\n            function onSuccess(data)\r\n            {\r\n                $(\"#resultLog\").html(\"Command Sent: \" + data);\r\n            }\r\n        });\r\n        </script>\r\n    </body>\r\n</html>\r\n```\r\n\r\nWhat this code does is that it creates three buttons on the screen. A color name is assigned to the value attribute of each buttons elements. In the jquery function, once the page is loaded a request is sent to event.php page sending this color value as parameter. The event.php page simply triggers gets the color name by get method and sends a request to OSGiBroker server for triggering an even with the color name on the application.\r\n\r\nevent.php\r\n\r\n```php\r\n<?php\r\n// Set your return content type\r\n//header('Content-type: application/xml');\r\n\r\n$daurl = \"http://localhost:8800/osgibroker/event?topic=tutorial&clientID=tutorial&_method=POST&eventName=\".$_GET['event'];\r\necho $daurl;\r\n\r\n// Get that website's content\r\n$handle = fopen($daurl, \"r\");\r\n\r\n// If there is something, read and return\r\nif ($handle) {\r\n    while (!feof($handle)) {\r\n        $buffer = fgets($handle, 4096);\r\n        echo $buffer;\r\n    }\r\n    fclose($handle);\r\n}\r\n?>\r\n```\r\n## Step 4: Setup application on the coffeshop framework\r\n\r\nTo setup the application on the coffeeshop framework, we need to create a new application on the coffeshop framework mainpage.\r\n\r\n![Creating a new application of Coffeeshop](https://github.com/hmrtk/Coffeshop-HTML5-jQuery-Mobile-Tutorial/blob/master/images/3.PNG?raw=true)\r\n\r\n\r\nThen we need to fill up the form for creating the new application:\r\n\r\n![New application settings](https://github.com/hmrtk/Coffeshop-HTML5-jQuery-Mobile-Tutorial/blob/master/images/4.PNG?raw=true)\r\n\r\n\r\n","tagline":"How to make an application for Coffeeshop framework using jQuerymobile, HTML5, PHP and Osgibroker","google":"UA-32717414-1","note":"Don't delete this file! It's used internally to help with page regeneration."}